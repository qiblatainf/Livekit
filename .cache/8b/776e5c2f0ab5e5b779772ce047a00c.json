{"id":"node_modules/livekit-client/dist/room/track/create.js","dependencies":[{"name":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\create.js.map","includedInParent":true,"mtime":1680887190798},{"name":"D:\\Livekit-Client\\package.json","includedInParent":true,"mtime":1680887270118},{"name":"D:\\Livekit-Client\\node_modules\\livekit-client\\package.json","includedInParent":true,"mtime":1680887189879},{"name":"../errors","loc":{"line":16,"column":25,"index":1124},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\create.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\errors.js"},{"name":"./LocalAudioTrack","loc":{"line":17,"column":50,"index":1188},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\create.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\LocalAudioTrack.js"},{"name":"./LocalTrack","loc":{"line":18,"column":45,"index":1256},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\create.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\LocalTrack.js"},{"name":"./LocalVideoTrack","loc":{"line":19,"column":50,"index":1324},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\create.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\LocalVideoTrack.js"},{"name":"./options","loc":{"line":20,"column":26,"index":1373},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\create.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\options.js"},{"name":"./Track","loc":{"line":21,"column":24,"index":1411},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\create.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\Track.js"}],"generated":{"js":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.createLocalScreenTracks = exports.createLocalAudioTrack = exports.createLocalVideoTrack = exports.createLocalTracks = exports.getLastVideoCreateError = exports.getLastAudioCreateError = void 0;\nconst errors_1 = require(\"../errors\");\nconst LocalAudioTrack_1 = __importDefault(require(\"./LocalAudioTrack\"));\nconst LocalTrack_1 = __importDefault(require(\"./LocalTrack\"));\nconst LocalVideoTrack_1 = __importDefault(require(\"./LocalVideoTrack\"));\nconst options_1 = require(\"./options\");\nconst Track_1 = require(\"./Track\");\nlet audioError;\nfunction getLastAudioCreateError() {\n    return audioError;\n}\nexports.getLastAudioCreateError = getLastAudioCreateError;\nlet videoError;\nfunction getLastVideoCreateError() {\n    return videoError;\n}\nexports.getLastVideoCreateError = getLastVideoCreateError;\n/**\n * Creates a local video and audio track at the same time. When acquiring both\n * audio and video tracks together, it'll display a single permission prompt to\n * the user instead of two separate ones.\n * @param options\n */\nfunction createLocalTracks(options) {\n    return __awaiter(this, void 0, void 0, function* () {\n        if (!options)\n            options = {};\n        if (options.audio === true)\n            options.audio = {};\n        if (options.video === true)\n            options.video = {};\n        const constraints = LocalTrack_1.default.constraintsForOptions(options);\n        let stream;\n        try {\n            stream = yield navigator.mediaDevices.getUserMedia(constraints);\n        }\n        catch (err) {\n            if (err instanceof Error) {\n                if (constraints.audio) {\n                    audioError = err;\n                }\n                if (constraints.video) {\n                    videoError = err;\n                }\n            }\n            throw err;\n        }\n        if (constraints.audio) {\n            audioError = undefined;\n        }\n        if (constraints.video) {\n            videoError = undefined;\n        }\n        return stream.getTracks().map((mediaStreamTrack) => {\n            const isAudio = mediaStreamTrack.kind === 'audio';\n            let trackOptions = isAudio ? options.audio : options.video;\n            if (typeof trackOptions === 'boolean' || !trackOptions) {\n                trackOptions = {};\n            }\n            let trackConstraints;\n            const conOrBool = isAudio ? constraints.audio : constraints.video;\n            if (typeof conOrBool !== 'boolean') {\n                trackConstraints = conOrBool;\n            }\n            const track = createLocalTrack(mediaStreamTrack, trackOptions === null || trackOptions === void 0 ? void 0 : trackOptions.name, trackConstraints);\n            if (track.kind === Track_1.Track.Kind.Video) {\n                track.source = Track_1.Track.Source.Camera;\n            }\n            else if (track.kind === Track_1.Track.Kind.Audio) {\n                track.source = Track_1.Track.Source.Microphone;\n            }\n            return track;\n        });\n    });\n}\nexports.createLocalTracks = createLocalTracks;\n/**\n * Creates a [[LocalVideoTrack]] with getUserMedia()\n * @param options\n */\nfunction createLocalVideoTrack(options) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const tracks = yield createLocalTracks({\n            audio: false,\n            video: options,\n        });\n        return tracks[0];\n    });\n}\nexports.createLocalVideoTrack = createLocalVideoTrack;\nfunction createLocalAudioTrack(options) {\n    return __awaiter(this, void 0, void 0, function* () {\n        const tracks = yield createLocalTracks({\n            audio: options,\n            video: false,\n        });\n        return tracks[0];\n    });\n}\nexports.createLocalAudioTrack = createLocalAudioTrack;\n/**\n * Creates a screen capture tracks with getDisplayMedia().\n * A LocalVideoTrack is always created and returned.\n * If { audio: true }, and the browser supports audio capture, a LocalAudioTrack is also created.\n */\nfunction createLocalScreenTracks(options) {\n    var _a;\n    return __awaiter(this, void 0, void 0, function* () {\n        if (options === undefined) {\n            options = {};\n        }\n        if (options.name === undefined) {\n            options.name = 'screen';\n        }\n        if (options.resolution === undefined) {\n            options.resolution = options_1.VideoPresets.fhd.resolution;\n        }\n        let videoConstraints = true;\n        if (options.resolution) {\n            videoConstraints = {\n                width: options.resolution.width,\n                height: options.resolution.height,\n            };\n        }\n        // typescript definition is missing getDisplayMedia: https://github.com/microsoft/TypeScript/issues/33232\n        // @ts-ignore\n        const stream = yield navigator.mediaDevices.getDisplayMedia({\n            audio: (_a = options.audio) !== null && _a !== void 0 ? _a : false,\n            video: videoConstraints,\n        });\n        const tracks = stream.getVideoTracks();\n        if (tracks.length === 0) {\n            throw new errors_1.TrackInvalidError('no video track found');\n        }\n        const screenVideo = new LocalVideoTrack_1.default(tracks[0], options.name);\n        screenVideo.source = Track_1.Track.Source.ScreenShare;\n        const localTracks = [screenVideo];\n        if (stream.getAudioTracks().length > 0) {\n            const screenAudio = new LocalAudioTrack_1.default(stream.getAudioTracks()[0], options.name);\n            screenAudio.source = Track_1.Track.Source.ScreenShareAudio;\n            localTracks.push(screenAudio);\n        }\n        return localTracks;\n    });\n}\nexports.createLocalScreenTracks = createLocalScreenTracks;\n/** @internal */\nfunction createLocalTrack(mediaStreamTrack, name, constraints) {\n    switch (mediaStreamTrack.kind) {\n        case 'audio':\n            return new LocalAudioTrack_1.default(mediaStreamTrack, name, constraints);\n        case 'video':\n            return new LocalVideoTrack_1.default(mediaStreamTrack, name, constraints);\n        default:\n            throw new errors_1.TrackInvalidError(`unsupported track type: ${mediaStreamTrack.kind}`);\n    }\n}\n"},"sourceMaps":{"js":{"version":3,"file":"create.js","sourceRoot":"","sources":["../../../src/room/track/create.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"ac08828ef9256137680bcbd1ae777904","cacheData":{"env":{}}}