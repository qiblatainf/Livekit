{"id":"node_modules/livekit-client/dist/room/track/LocalTrack.js","dependencies":[{"name":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\LocalTrack.js.map","includedInParent":true,"mtime":1680887195335},{"name":"D:\\Livekit-Client\\package.json","includedInParent":true,"mtime":1680887270118},{"name":"D:\\Livekit-Client\\node_modules\\livekit-client\\package.json","includedInParent":true,"mtime":1680887189879},{"name":"../../logger","loc":{"line":15,"column":41,"index":938},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\LocalTrack.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\logger.js"},{"name":"../defaults","loc":{"line":16,"column":27,"index":983},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\LocalTrack.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\defaults.js"},{"name":"../DeviceManager","loc":{"line":17,"column":48,"index":1047},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\LocalTrack.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\DeviceManager.js"},{"name":"../errors","loc":{"line":18,"column":25,"index":1094},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\LocalTrack.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\errors.js"},{"name":"../events","loc":{"line":19,"column":25,"index":1133},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\LocalTrack.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\events.js"},{"name":"./Track","loc":{"line":20,"column":24,"index":1171},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\LocalTrack.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\Track.js"}],"generated":{"js":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst logger_1 = __importDefault(require(\"../../logger\"));\nconst defaults_1 = require(\"../defaults\");\nconst DeviceManager_1 = __importDefault(require(\"../DeviceManager\"));\nconst errors_1 = require(\"../errors\");\nconst events_1 = require(\"../events\");\nconst Track_1 = require(\"./Track\");\nclass LocalTrack extends Track_1.Track {\n    constructor(mediaTrack, kind, name, constraints) {\n        super(mediaTrack, kind, name);\n        this.handleEnded = () => {\n            this.emit(events_1.TrackEvent.Ended);\n        };\n        this.mediaStreamTrack.addEventListener('ended', this.handleEnded);\n        this.constraints = constraints !== null && constraints !== void 0 ? constraints : mediaTrack.getConstraints();\n    }\n    get id() {\n        return this.mediaStreamTrack.id;\n    }\n    get dimensions() {\n        if (this.kind !== Track_1.Track.Kind.Video) {\n            return undefined;\n        }\n        const { width, height } = this.mediaStreamTrack.getSettings();\n        if (width && height) {\n            return {\n                width,\n                height,\n            };\n        }\n        return undefined;\n    }\n    static constraintsForOptions(options) {\n        const constraints = {};\n        // default video options\n        const defaults = defaults_1.getTrackCaptureDefaults();\n        const videoOptions = {\n            deviceId: defaults.videoDeviceId,\n        };\n        if (defaults.videoResolution) {\n            videoOptions.width = defaults.videoResolution.width;\n            videoOptions.height = defaults.videoResolution.height;\n            videoOptions.frameRate = defaults.videoResolution.frameRate;\n        }\n        if (typeof options.video === 'object' && options.video) {\n            Object.assign(videoOptions, options.video);\n            if (options.video.resolution) {\n                Object.assign(videoOptions, options.video.resolution);\n            }\n        }\n        if (options.video === false) {\n            constraints.video = false;\n        }\n        else {\n            // use defaults\n            constraints.video = videoOptions;\n        }\n        // default audio options\n        const audioOptions = {\n            deviceId: defaults.audioDeviceId,\n            echoCancellation: defaults.echoCancellation,\n            /* @ts-ignore */\n            autoGainControl: defaults.autoGainControl,\n            /* @ts-ignore */\n            noiseSuppression: defaults.noiseSuppression,\n            channelCount: defaults.channelCount,\n        };\n        if (typeof options.audio === 'object' && options.audio) {\n            Object.assign(audioOptions, options.audio);\n        }\n        if (options.audio === false) {\n            constraints.audio = false;\n        }\n        else {\n            constraints.audio = audioOptions;\n        }\n        return constraints;\n    }\n    /**\n     * @returns DeviceID of the device that is currently being used for this track\n     */\n    getDeviceId() {\n        return __awaiter(this, void 0, void 0, function* () {\n            // screen share doesn't have a usable device id\n            if (this.source === Track_1.Track.Source.ScreenShare) {\n                return;\n            }\n            const { deviceId, groupId } = this.mediaStreamTrack.getSettings();\n            const kind = this.kind === Track_1.Track.Kind.Audio ? 'audioinput' : 'videoinput';\n            return DeviceManager_1.default.getInstance().normalizeDeviceId(kind, deviceId, groupId);\n        });\n    }\n    mute() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.setTrackMuted(true);\n            return this;\n        });\n    }\n    unmute() {\n        return __awaiter(this, void 0, void 0, function* () {\n            this.setTrackMuted(false);\n            return this;\n        });\n    }\n    restart(constraints) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (!this.sender) {\n                throw new errors_1.TrackInvalidError('unable to restart an unpublished track');\n            }\n            if (!constraints) {\n                constraints = this.constraints;\n            }\n            logger_1.default.debug('restarting track with constraints', constraints);\n            const streamConstraints = {\n                audio: false,\n                video: false,\n            };\n            if (this.kind === Track_1.Track.Kind.Video) {\n                streamConstraints.video = constraints;\n            }\n            else {\n                streamConstraints.audio = constraints;\n            }\n            // detach\n            this.attachedElements.forEach((el) => {\n                Track_1.detachTrack(this.mediaStreamTrack, el);\n            });\n            this.mediaStreamTrack.removeEventListener('ended', this.handleEnded);\n            // on Safari, the old audio track must be stopped before attempting to acquire\n            // the new track, otherwise the new track will stop with\n            // 'A MediaStreamTrack ended due to a capture failure`\n            this.mediaStreamTrack.stop();\n            // create new track and attach\n            const mediaStream = yield navigator.mediaDevices.getUserMedia(streamConstraints);\n            const newTrack = mediaStream.getTracks()[0];\n            newTrack.addEventListener('ended', this.handleEnded);\n            logger_1.default.debug('re-acquired MediaStreamTrack');\n            yield this.sender.replaceTrack(newTrack);\n            this.mediaStreamTrack = newTrack;\n            this.attachedElements.forEach((el) => {\n                Track_1.attachToElement(newTrack, el);\n            });\n            this.constraints = constraints;\n            return this;\n        });\n    }\n    setTrackMuted(muted) {\n        if (this.isMuted === muted) {\n            return;\n        }\n        this.isMuted = muted;\n        this.mediaStreamTrack.enabled = !muted;\n        this.emit(muted ? events_1.TrackEvent.Muted : events_1.TrackEvent.Unmuted, this);\n    }\n}\nexports.default = LocalTrack;\n"},"sourceMaps":{"js":{"version":3,"file":"LocalTrack.js","sourceRoot":"","sources":["../../../src/room/track/LocalTrack.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"3de780677b0017162c8fb22cad21b987","cacheData":{"env":{}}}