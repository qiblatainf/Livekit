{"id":"node_modules/livekit-client/dist/room/PCTransport.js","dependencies":[{"name":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\PCTransport.js.map","includedInParent":true,"mtime":1680887197230},{"name":"D:\\Livekit-Client\\package.json","includedInParent":true,"mtime":1680887270118},{"name":"D:\\Livekit-Client\\node_modules\\livekit-client\\package.json","includedInParent":true,"mtime":1680887189879},{"name":"ts-debounce","loc":{"line":15,"column":30,"index":927},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\PCTransport.js","resolved":"D:\\Livekit-Client\\node_modules\\ts-debounce\\dist\\src\\index.esm.js"},{"name":"../logger","loc":{"line":16,"column":41,"index":984},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\PCTransport.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\logger.js"}],"generated":{"js":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ts_debounce_1 = require(\"ts-debounce\");\nconst logger_1 = __importDefault(require(\"../logger\"));\n/** @internal */\nclass PCTransport {\n    constructor(config) {\n        this.pendingCandidates = [];\n        this.restartingIce = false;\n        this.renegotiate = false;\n        // debounced negotiate interface\n        this.negotiate = ts_debounce_1.debounce(() => { this.createAndSendOffer(); }, 100);\n        this.pc = new RTCPeerConnection(config);\n    }\n    get isICEConnected() {\n        return this.pc.iceConnectionState === 'connected' || this.pc.iceConnectionState === 'completed';\n    }\n    addIceCandidate(candidate) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.pc.remoteDescription && !this.restartingIce) {\n                return this.pc.addIceCandidate(candidate);\n            }\n            this.pendingCandidates.push(candidate);\n        });\n    }\n    setRemoteDescription(sd) {\n        return __awaiter(this, void 0, void 0, function* () {\n            yield this.pc.setRemoteDescription(sd);\n            this.pendingCandidates.forEach((candidate) => {\n                this.pc.addIceCandidate(candidate);\n            });\n            this.pendingCandidates = [];\n            this.restartingIce = false;\n            if (this.renegotiate) {\n                this.renegotiate = false;\n                this.createAndSendOffer();\n            }\n        });\n    }\n    createAndSendOffer(options) {\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this.onOffer === undefined) {\n                return;\n            }\n            if (options === null || options === void 0 ? void 0 : options.iceRestart) {\n                logger_1.default.debug('restarting ICE');\n                this.restartingIce = true;\n            }\n            if (this.pc.signalingState === 'have-local-offer') {\n                // we're waiting for the peer to accept our offer, so we'll just wait\n                // the only exception to this is when ICE restart is needed\n                const currentSD = this.pc.remoteDescription;\n                if ((options === null || options === void 0 ? void 0 : options.iceRestart) && currentSD) {\n                    // TODO: handle when ICE restart is needed but we don't have a remote description\n                    // the best thing to do is to recreate the peerconnection\n                    yield this.pc.setRemoteDescription(currentSD);\n                }\n                else {\n                    this.renegotiate = true;\n                    return;\n                }\n            }\n            // actually negotiate\n            logger_1.default.debug('starting to negotiate');\n            const offer = yield this.pc.createOffer(options);\n            yield this.pc.setLocalDescription(offer);\n            this.onOffer(offer);\n        });\n    }\n    close() {\n        this.pc.close();\n    }\n}\nexports.default = PCTransport;\n"},"sourceMaps":{"js":{"version":3,"file":"PCTransport.js","sourceRoot":"","sources":["../../src/room/PCTransport.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"224b9198786236936365fbe5e06bb2d3","cacheData":{"env":{}}}