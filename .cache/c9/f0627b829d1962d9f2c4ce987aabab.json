{"id":"node_modules/livekit-client/dist/room/track/RemoteVideoTrack.js","dependencies":[{"name":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\RemoteVideoTrack.js.map","includedInParent":true,"mtime":1680887198111},{"name":"D:\\Livekit-Client\\package.json","includedInParent":true,"mtime":1680887270118},{"name":"D:\\Livekit-Client\\node_modules\\livekit-client\\package.json","includedInParent":true,"mtime":1680887189879},{"name":"ts-debounce","loc":{"line":3,"column":30,"index":107},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\RemoteVideoTrack.js","resolved":"D:\\Livekit-Client\\node_modules\\ts-debounce\\dist\\src\\index.esm.js"},{"name":"../events","loc":{"line":4,"column":25,"index":148},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\RemoteVideoTrack.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\events.js"},{"name":"../utils","loc":{"line":5,"column":24,"index":186},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\RemoteVideoTrack.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\utils.js"},{"name":"./Track","loc":{"line":6,"column":24,"index":223},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\RemoteVideoTrack.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\Track.js"}],"generated":{"js":"\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nconst ts_debounce_1 = require(\"ts-debounce\");\nconst events_1 = require(\"../events\");\nconst utils_1 = require(\"../utils\");\nconst Track_1 = require(\"./Track\");\nconst REACTION_DELAY = 1000;\nclass RemoteVideoTrack extends Track_1.Track {\n    constructor(mediaTrack, sid, receiver, autoManaged) {\n        super(mediaTrack, Track_1.Track.Kind.Video);\n        this.elementInfos = [];\n        this.handleVisibilityChanged = (entry) => {\n            const { target, isIntersecting } = entry;\n            const elementInfo = this.elementInfos.find((info) => info.element === target);\n            if (elementInfo) {\n                elementInfo.visible = isIntersecting;\n                elementInfo.visibilityChangedAt = Date.now();\n            }\n            this.updateVisibility();\n        };\n        this.debouncedHandleVisibilityChanged = ts_debounce_1.debounce(this.handleVisibilityChanged, REACTION_DELAY);\n        this.handleResize = (entry) => {\n            const { target, contentRect } = entry;\n            const elementInfo = this.elementInfos.find((info) => info.element === target);\n            if (elementInfo) {\n                elementInfo.width = contentRect.width;\n                elementInfo.height = contentRect.height;\n            }\n            this.updateDimensions();\n        };\n        this.debouncedHandleResize = ts_debounce_1.debounce(this.handleResize, REACTION_DELAY);\n        // override id to parsed ID\n        this.sid = sid;\n        this.receiver = receiver;\n        this.autoManaged = autoManaged;\n    }\n    get isAutoManaged() {\n        var _a;\n        return (_a = this.autoManaged) !== null && _a !== void 0 ? _a : false;\n    }\n    /** @internal */\n    setMuted(muted) {\n        if (this.isMuted !== muted) {\n            this.isMuted = muted;\n            this.emit(muted ? events_1.TrackEvent.Muted : events_1.TrackEvent.Unmuted, this);\n        }\n        this.attachedElements.forEach((element) => {\n            // detach or attach\n            if (muted) {\n                Track_1.detachTrack(this.mediaStreamTrack, element);\n            }\n            else {\n                Track_1.attachToElement(this.mediaStreamTrack, element);\n            }\n        });\n    }\n    attach(element) {\n        if (!element) {\n            element = super.attach();\n        }\n        super.attach(element);\n        if (this.autoManaged) {\n            this.elementInfos.push({\n                element,\n                visible: true,\n                width: element.clientWidth,\n                height: element.clientHeight,\n            });\n            element\n                .handleResize = this.debouncedHandleResize;\n            element\n                .handleVisibilityChanged = this.debouncedHandleVisibilityChanged;\n            utils_1.getIntersectionObserver().observe(element);\n            utils_1.getResizeObserver().observe(element);\n        }\n        return element;\n    }\n    detach(element) {\n        let detachedElements = [];\n        if (element) {\n            detachedElements.push(element);\n            return super.detach(element);\n        }\n        detachedElements = super.detach();\n        for (const e of detachedElements) {\n            this.stopObservingElement(e);\n        }\n        return detachedElements;\n    }\n    start() {\n        // use `enabled` of track to enable re-use of transceiver\n        super.enable();\n    }\n    stop() {\n        // use `enabled` of track to enable re-use of transceiver\n        super.disable();\n    }\n    stopObservingElement(element) {\n        var _a, _b;\n        (_a = utils_1.getIntersectionObserver()) === null || _a === void 0 ? void 0 : _a.unobserve(element);\n        (_b = utils_1.getResizeObserver()) === null || _b === void 0 ? void 0 : _b.unobserve(element);\n        this.elementInfos = this.elementInfos.filter((info) => info.element !== element);\n    }\n    updateVisibility() {\n        const lastVisibilityChange = this.elementInfos.reduce((prev, info) => Math.max(prev, info.visibilityChangedAt || 0), 0);\n        const isVisible = this.elementInfos.some((info) => info.visible);\n        if (this.lastVisible === isVisible) {\n            return;\n        }\n        if (!isVisible && Date.now() - lastVisibilityChange < REACTION_DELAY) {\n            // delay hidden events\n            setTimeout(() => {\n                this.updateVisibility();\n            }, Date.now() - lastVisibilityChange);\n            return;\n        }\n        this.lastVisible = isVisible;\n        this.emit(events_1.TrackEvent.VisibilityChanged, isVisible, this);\n    }\n    updateDimensions() {\n        var _a, _b;\n        let maxWidth = 0;\n        let maxHeight = 0;\n        for (const info of this.elementInfos) {\n            if (info.visible) {\n                if (info.width + info.height > maxWidth + maxHeight) {\n                    maxWidth = info.width;\n                    maxHeight = info.height;\n                }\n            }\n        }\n        if (((_a = this.lastDimensions) === null || _a === void 0 ? void 0 : _a.width) === maxWidth && ((_b = this.lastDimensions) === null || _b === void 0 ? void 0 : _b.height) === maxHeight) {\n            return;\n        }\n        this.lastDimensions = {\n            width: maxWidth,\n            height: maxHeight,\n        };\n        this.emit(events_1.TrackEvent.VideoDimensionsChanged, this.lastDimensions, this);\n    }\n}\nexports.default = RemoteVideoTrack;\n"},"sourceMaps":{"js":{"version":3,"file":"RemoteVideoTrack.js","sourceRoot":"","sources":["../../../src/room/track/RemoteVideoTrack.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"480cc41823a26a1a7008d64ebee3a8c5","cacheData":{"env":{}}}