{"id":"node_modules/livekit-client/dist/connect.js","dependencies":[{"name":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\connect.js.map","includedInParent":true,"mtime":1680887190468},{"name":"D:\\Livekit-Client\\package.json","includedInParent":true,"mtime":1680887270118},{"name":"D:\\Livekit-Client\\node_modules\\livekit-client\\package.json","includedInParent":true,"mtime":1680887189879},{"name":"./api/SignalClient","loc":{"line":16,"column":31,"index":972},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\connect.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\api\\SignalClient.js"},{"name":"./logger","loc":{"line":17,"column":41,"index":1036},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\connect.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\logger.js"},{"name":"./options","loc":{"line":18,"column":26,"index":1076},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\connect.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\options.js"},{"name":"./room/errors","loc":{"line":19,"column":25,"index":1115},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\connect.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\errors.js"},{"name":"./room/events","loc":{"line":20,"column":25,"index":1158},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\connect.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\events.js"},{"name":"./room/Room","loc":{"line":21,"column":39,"index":1215},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\connect.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\Room.js"},{"name":"./room/track/create","loc":{"line":22,"column":25,"index":1257},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\connect.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\create.js"},{"name":"./room/track/Track","loc":{"line":23,"column":24,"index":1305},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\connect.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\room\\track\\Track.js"},{"name":"./version","loc":{"line":24,"column":24,"index":1352},"parent":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\connect.js","resolved":"D:\\Livekit-Client\\node_modules\\livekit-client\\dist\\version.js"}],"generated":{"js":"\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.connect = exports.version = void 0;\nconst SignalClient_1 = require(\"./api/SignalClient\");\nconst logger_1 = __importDefault(require(\"./logger\"));\nconst options_1 = require(\"./options\");\nconst errors_1 = require(\"./room/errors\");\nconst events_1 = require(\"./room/events\");\nconst Room_1 = __importDefault(require(\"./room/Room\"));\nconst create_1 = require(\"./room/track/create\");\nconst Track_1 = require(\"./room/track/Track\");\nvar version_1 = require(\"./version\");\nObject.defineProperty(exports, \"version\", { enumerable: true, get: function () { return version_1.version; } });\n/**\n * Connects to a LiveKit room\n *\n * ```typescript\n * connect('wss://myhost.livekit.io', token, {\n *   // publish audio and video tracks on joining\n *   audio: true,\n *   video: true,\n *   captureDefaults: {\n *    facingMode: 'user',\n *   },\n * })\n * ```\n * @param url URL to LiveKit server\n * @param token AccessToken, a JWT token that includes authentication and room details\n * @param options\n */\nfunction connect(url, token, options) {\n    var _a;\n    return __awaiter(this, void 0, void 0, function* () {\n        // set defaults\n        options || (options = {});\n        options.logLevel || (options.logLevel = options_1.LogLevel.info);\n        if (options.audio === undefined)\n            options.audio = false;\n        if (options.video === undefined)\n            options.video = false;\n        logger_1.default.setLevel(options.logLevel);\n        const config = (_a = options.rtcConfig) !== null && _a !== void 0 ? _a : {};\n        if (options.iceServers) {\n            config.iceServers = options.iceServers;\n        }\n        const client = new SignalClient_1.WSSignalClient();\n        const room = new Room_1.default(client, {\n            rtcConfig: options.rtcConfig,\n            autoManageVideo: options.autoManageVideo,\n        });\n        // connect to room\n        yield room.connect(url, token, {\n            autoSubscribe: options === null || options === void 0 ? void 0 : options.autoSubscribe,\n        });\n        // save default publish options\n        if (options.publishDefaults) {\n            Object.assign(room.defaultPublishOptions, options.publishDefaults);\n        }\n        if (options.captureDefaults) {\n            Object.assign(room.defaultCaptureOptions, options.captureDefaults);\n        }\n        const publishAudio = options.audio;\n        const publishVideo = options.video;\n        const sources = [];\n        if (publishAudio) {\n            sources.push(Track_1.Track.Source.Microphone);\n        }\n        if (publishVideo) {\n            sources.push(Track_1.Track.Source.Camera);\n        }\n        // lock to prevent user from publishing the same sources\n        sources.forEach((s) => room.localParticipant.pendingPublishing.add(s));\n        if (publishAudio || publishVideo) {\n            setTimeout(() => __awaiter(this, void 0, void 0, function* () {\n                let tracks;\n                try {\n                    tracks = yield create_1.createLocalTracks({\n                        audio: publishAudio,\n                        video: publishVideo,\n                    });\n                }\n                catch (e) {\n                    const errKind = errors_1.MediaDeviceFailure.getFailure(e);\n                    logger_1.default.warn('received error while creating media', errKind);\n                    if (e instanceof Error) {\n                        logger_1.default.warn(e.message);\n                    }\n                    // when audio and video are both requested, give audio only a shot\n                    if ((errKind === errors_1.MediaDeviceFailure.NotFound || errKind === errors_1.MediaDeviceFailure.DeviceInUse)\n                        && publishAudio && publishVideo) {\n                        try {\n                            tracks = yield create_1.createLocalTracks({\n                                audio: publishAudio,\n                                video: false,\n                            });\n                        }\n                        catch (audioErr) {\n                            // ignore\n                        }\n                    }\n                    if (!tracks) {\n                        room.emit(events_1.RoomEvent.MediaDevicesError, e);\n                        logger_1.default.error('could not create media', e);\n                        sources.forEach((s) => room.localParticipant.pendingPublishing.delete(s));\n                        return;\n                    }\n                }\n                try {\n                    yield Promise.all(tracks.map((track) => room.localParticipant.publishTrack(track)));\n                }\n                finally {\n                    sources.forEach((s) => room.localParticipant.pendingPublishing.delete(s));\n                }\n            }));\n        }\n        return room;\n    });\n}\nexports.connect = connect;\n"},"sourceMaps":{"js":{"version":3,"file":"connect.js","sourceRoot":"","sources":["../src/connect.ts"],"names":[],"mappings":"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","sourcesContent":[null]}},"error":null,"hash":"72e34793df904e4cc9a616dacfb09d62","cacheData":{"env":{}}}